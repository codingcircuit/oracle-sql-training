# 14. Dynamic SQL
Dynamic SQL in PL/SQL allows for the execution of SQL statements that are constructed at runtime. This provides flexibility and enables the execution of SQL queries and DML operations that are determined dynamically, rather than being hard-coded.

## Index

1. [Introduction](#introduction)
2. [Syntax](#syntax)
3. [PL/SQL Dynamic SQL Techniques](#plsql-dynamic-sql-techniques)
   1. [EXECUTE IMMEDIATE](#execute-immediate)
   2. [DBMS_SQL Package](#dbms_sql-package)
4. [Use Cases](#use-cases)
5. [Advantages](#advantages)
6. [Examples](#examples)
   1. [Basic SELECT Statement](#example-1-basic-select-statement)
   2. [Dynamic Table Names](#example-2-dynamic-table-names)
   3. [Dynamic Columns](#example-3-dynamic-columns)
   4. [Dynamic WHERE Clauses](#example-4-dynamic-where-clauses)
   5. [Dynamic DML Operations](#example-5-dynamic-dml-operations)
   6. [Parameterized Dynamic SQL](#example-6-parameterized-dynamic-sql)
   7. [Using DBMS_SQL Package](#example-7-using-dbms_sql-package)
   8. [Dynamic PL/SQL Block Execution](#example-8-dynamic-plsql-block-execution)
   9. [Dynamic SQL with Bind Variables](#example-9-dynamic-sql-with-bind-variables)
   10. [Dynamic SQL for Schema Management](#example-10-dynamic-sql-for-schema-management)
7. [Conclusion](#conclusion)

## Introduction

Dynamic SQL in PL/SQL refers to SQL statements that are generated and executed at runtime. It provides the ability to construct and run SQL commands dynamically based on varying conditions or user inputs. This is essential for applications requiring high flexibility and adaptability.

## Syntax

### EXECUTE IMMEDIATE

```sql
EXECUTE IMMEDIATE 'SQL_STATEMENT' [USING bind_arguments];
```

### DBMS_SQL Package

```sql
DECLARE
    cursor_id   NUMBER;
    sql_stmt    VARCHAR2(1000);
BEGIN
    cursor_id := DBMS_SQL.OPEN_CURSOR;
    DBMS_SQL.PARSE(cursor_id, sql_stmt, DBMS_SQL.NATIVE);
    DBMS_SQL.EXECUTE(cursor_id);
    DBMS_SQL.CLOSE_CURSOR(cursor_id);
END;
/
```

## PL/SQL Dynamic SQL Techniques

### EXECUTE IMMEDIATE

The `EXECUTE IMMEDIATE` statement is used for executing a single SQL statement that is dynamically built. It supports SQL queries, DML statements, and PL/SQL anonymous blocks.

### DBMS_SQL Package

The `DBMS_SQL` package provides more control and flexibility for executing dynamic SQL. It is useful for complex scenarios involving multiple SQL statements or when needing to handle SQL statements with bind variables.

## Use Cases

1. **Dynamic Query Execution**: Run SQL queries where the structure (e.g., table names, columns) is not known until runtime.
2. **Schema Management**: Create, alter, or drop database objects dynamically based on conditions.
3. **Flexible Reporting**: Generate reports with varying formats or structures.
4. **Data Transformation**: Perform operations on tables or columns that are determined at runtime.

## Advantages

1. **Flexibility**: Allows for the execution of SQL statements whose structure is determined at runtime.
2. **Reusability**: Code can be reused with different SQL statements or parameters.
3. **Adaptability**: Adapts to changing requirements without modifying the PL/SQL code.
4. **Complex Queries**: Enables the construction of complex SQL queries and DML operations dynamically.

## Examples

### Example 1: Basic SELECT Statement

#### Execute a Simple Query

```sql
DECLARE
    v_sql VARCHAR2(100);
    v_emp_name VARCHAR2(50);
BEGIN
    v_sql := 'SELECT emp_name FROM employees WHERE emp_id = 100';
    EXECUTE IMMEDIATE v_sql INTO v_emp_name;
    DBMS_OUTPUT.PUT_LINE('Employee Name: ' || v_emp_name);
END;
/
```

### Example 2: Dynamic Table Names

#### Query with Dynamic Table Names

```sql
DECLARE
    v_table_name VARCHAR2(30) := 'employees';
    v_sql        VARCHAR2(100);
    v_emp_count  NUMBER;
BEGIN
    v_sql := 'SELECT COUNT(*) FROM ' || v_table_name;
    EXECUTE IMMEDIATE v_sql INTO v_emp_count;
    DBMS_OUTPUT.PUT_LINE('Number of employees: ' || v_emp_count);
END;
/
```

### Example 3: Dynamic Columns

#### Query with Dynamic Columns

```sql
DECLARE
    v_column_name VARCHAR2(30) := 'emp_name';
    v_sql         VARCHAR2(100);
    v_column_value VARCHAR2(50);
BEGIN
    v_sql := 'SELECT ' || v_column_name || ' FROM employees WHERE emp_id = 100';
    EXECUTE IMMEDIATE v_sql INTO v_column_value;
    DBMS_OUTPUT.PUT_LINE('Employee Detail: ' || v_column_value);
END;
/
```

### Example 4: Dynamic WHERE Clauses

#### Query with Dynamic WHERE Clauses

```sql
DECLARE
    v_condition VARCHAR2(50) := 'emp_salary > 50000';
    v_sql       VARCHAR2(100);
    v_emp_count NUMBER;
BEGIN
    v_sql := 'SELECT COUNT(*) FROM employees WHERE ' || v_condition;
    EXECUTE IMMEDIATE v_sql INTO v_emp_count;
    DBMS_OUTPUT.PUT_LINE('Number of employees with high salary: ' || v_emp_count);
END;
/
```

### Example 5: Dynamic DML Operations

#### Insert Operation with Dynamic SQL

```sql
DECLARE
    v_table_name VARCHAR2(30) := 'employees';
    v_sql        VARCHAR2(100);
BEGIN
    v_sql := 'INSERT INTO ' || v_table_name || ' (emp_id, emp_name, emp_salary) VALUES (200, ''John Doe'', 60000)';
    EXECUTE IMMEDIATE v_sql;
    DBMS_OUTPUT.PUT_LINE('Employee inserted successfully.');
END;
/
```

### Example 6: Parameterized Dynamic SQL

#### Using Parameters in Dynamic SQL

```sql
DECLARE
    v_emp_id     NUMBER := 100;
    v_emp_name   VARCHAR2(50);
    v_sql        VARCHAR2(100);
BEGIN
    v_sql := 'SELECT emp_name FROM employees WHERE emp_id = :id';
    EXECUTE IMMEDIATE v_sql INTO v_emp_name USING v_emp_id;
    DBMS_OUTPUT.PUT_LINE('Employee Name: ' || v_emp_name);
END;
/
```

### Example 7: Using DBMS_SQL Package

#### Executing SQL with DBMS_SQL

```sql
DECLARE
    cursor_id   NUMBER;
    v_sql       VARCHAR2(100) := 'SELECT emp_name FROM employees WHERE emp_id = 100';
    v_emp_name  VARCHAR2(50);
BEGIN
    cursor_id := DBMS_SQL.OPEN_CURSOR;
    DBMS_SQL.PARSE(cursor_id, v_sql, DBMS_SQL.SELECT_STATEMENT);
    DBMS_SQL.DEFINE_COLUMN(cursor_id, 1, v_emp_name);
    DBMS_SQL.EXECUTE(cursor_id);
    DBMS_SQL.FETCH_ROWS(cursor_id);
    DBMS_SQL.COLUMN_VALUE(cursor_id, 1, v_emp_name);
    DBMS_OUTPUT.PUT_LINE('Employee Name: ' || v_emp_name);
    DBMS_SQL.CLOSE_CURSOR(cursor_id);
END;
/
```

### Example 8: Dynamic PL/SQL Block Execution

#### Executing a Dynamic PL/SQL Block

```sql
DECLARE
    v_sql VARCHAR2(4000);
BEGIN
    v_sql := 'BEGIN DBMS_OUTPUT.PUT_LINE(''Hello from dynamic PL/SQL block''); END;';
    EXECUTE IMMEDIATE v_sql;
END;
/
```

### Example 9: Dynamic SQL with Bind Variables

#### Using Bind Variables in Dynamic SQL

```sql
DECLARE
    v_min_salary NUMBER := 30000;
    v_sql        VARCHAR2(100);
    v_emp_count  NUMBER;
BEGIN
    v_sql := 'SELECT COUNT(*) FROM employees WHERE emp_salary > :salary';
    EXECUTE IMMEDIATE v_sql INTO v_emp_count USING v_min_salary;
    DBMS_OUTPUT.PUT_LINE('Number of employees with salary above threshold: ' || v_emp_count);
END;
/
```

### Example 10: Dynamic SQL for Schema Management

#### Creating a Table Dynamically

```sql
DECLARE
    v_table_name VARCHAR2(30) := 'new_employees';
    v_sql        VARCHAR2(100);
BEGIN
    v_sql := 'CREATE TABLE ' || v_table_name || ' (emp_id NUMBER PRIMARY KEY, emp_name VARCHAR2(50), emp_salary NUMBER)';
    EXECUTE IMMEDIATE v_sql;
    DBMS_OUTPUT.PUT_LINE('Table ' || v_table_name || ' created successfully.');
END;
/
```

