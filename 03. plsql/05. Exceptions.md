# 5. Exceptions

Exception handling in PL/SQL is a mechanism to gracefully handle errors and exceptions that occur during the execution of PL/SQL blocks. Proper exception handling ensures that errors are caught and managed, rather than causing the entire program to fail.

## 1. Exception Types

### 1.1 Predefined Exceptions

PL/SQL provides a set of predefined exceptions that correspond to common error conditions. These exceptions are predefined and can be used directly in your PL/SQL blocks.

#### Common Predefined Exceptions

- `ZERO_DIVIDE`: Raised when a division by zero occurs.
- `NO_DATA_FOUND`: Raised when a `SELECT INTO` statement does not return any rows.
- `TOO_MANY_ROWS`: Raised when a `SELECT INTO` statement returns more than one row.
- `DUP_VAL_ON_INDEX`: Raised when an attempt is made to insert a duplicate value into a column with a unique constraint.
- `INVALID_CURSOR`: Raised when an invalid cursor operation is performed.

#### Example

```sql
BEGIN
    -- Code that might raise an exception
    DECLARE
        v_number NUMBER;
    BEGIN
        v_number := 10 / 0; -- This will raise a ZERO_DIVIDE exception
    EXCEPTION
        WHEN ZERO_DIVIDE THEN
            DBMS_OUTPUT.PUT_LINE('Error: Division by zero.');
    END;
END;
```

### 1.2 User-Defined Exceptions

You can also define your own exceptions to handle specific error conditions in your PL/SQL blocks.

#### Syntax

```sql
DECLARE
    custom_exception EXCEPTION;
BEGIN
    -- Code that might raise an exception
    RAISE custom_exception; -- Raising a user-defined exception
EXCEPTION
    WHEN custom_exception THEN
        -- Exception handling code
END;
```

#### Example

```sql
DECLARE
    v_age NUMBER := -5;
    age_exception EXCEPTION;
BEGIN
    IF v_age < 0 THEN
        RAISE age_exception;
    END IF;
EXCEPTION
    WHEN age_exception THEN
        DBMS_OUTPUT.PUT_LINE('Error: Age cannot be negative.');
END;
```

## 2. Exception Handling Block

The `EXCEPTION` block is used to handle exceptions that are raised in the `BEGIN` block of a PL/SQL block.

### Syntax

```sql
BEGIN
    -- Executable statements
EXCEPTION
    WHEN exception_name1 THEN
        -- Handling code for exception_name1
    WHEN exception_name2 THEN
        -- Handling code for exception_name2
    WHEN OTHERS THEN
        -- Handling code for all other exceptions
END;
```

### Example

```sql
BEGIN
    DECLARE
        v_salary NUMBER := 1000;
        v_divisor NUMBER := 0;
        v_result NUMBER;
    BEGIN
        v_result := v_salary / v_divisor; -- May raise ZERO_DIVIDE exception
    EXCEPTION
        WHEN ZERO_DIVIDE THEN
            DBMS_OUTPUT.PUT_LINE('Error: Division by zero.');
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('An unexpected error occurred: ' || SQLERRM);
    END;
END;
```

## 3. Exception Propagation

Exceptions can be propagated from a sub-block to an enclosing block. If an exception is not handled in the current block, it propagates to the calling block.

### Example

```sql
BEGIN
    DECLARE
        v_salary NUMBER := 1000;
        v_divisor NUMBER := 0;
        v_result NUMBER;
    BEGIN
        v_result := v_salary / v_divisor; -- May raise ZERO_DIVIDE exception
    EXCEPTION
        WHEN ZERO_DIVIDE THEN
            DBMS_OUTPUT.PUT_LINE('Inner block error: Division by zero.');
            RAISE; -- Propagates the exception to the outer block
    END;
EXCEPTION
    WHEN ZERO_DIVIDE THEN
        DBMS_OUTPUT.PUT_LINE('Outer block error: Division by zero.');
END;
```

## 4. SQLCODE and SQLERRM

### 4.1 SQLCODE

The `SQLCODE` function returns the error number of the last exception encountered.

#### Example

```sql
BEGIN
    DECLARE
        v_number NUMBER := 1 / 0; -- Division by zero
    EXCEPTION
        WHEN ZERO_DIVIDE THEN
            DBMS_OUTPUT.PUT_LINE('SQLCODE: ' || SQLCODE);
    END;
END;
```

### 4.2 SQLERRM

The `SQLERRM` function returns the error message associated with the last exception encountered.

#### Example

```sql
BEGIN
    DECLARE
        v_number NUMBER := 1 / 0; -- Division by zero
    EXCEPTION
        WHEN ZERO_DIVIDE THEN
            DBMS_OUTPUT.PUT_LINE('Error Message: ' || SQLERRM);
    END;
END;
```

## 5. RAISE_APPLICATION_ERROR

The `RAISE_APPLICATION_ERROR` procedure allows you to generate custom error messages.

### Syntax

```sql
RAISE_APPLICATION_ERROR(error_number, message);
```

- `error_number`: A negative number between -20000 and -20999.
- `message`: The error message text.

#### Example

```sql
BEGIN
    DECLARE
        v_age NUMBER := -5;
    BEGIN
        IF v_age < 0 THEN
            RAISE_APPLICATION_ERROR(-20001, 'Age cannot be negative.');
        END IF;
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
    END;
END;
```

