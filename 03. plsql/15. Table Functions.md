# 15. Table Functions

Table functions in PL/SQL allow you to return a set of rows from a function, which can be queried as if they were a table. This is particularly useful for complex data processing and for integrating PL/SQL with SQL operations. 

## What is a Table Function?

A table function is a special kind of PL/SQL function that returns a collection of rows. It is designed to be used in a SQL query like a table, making it possible to incorporate procedural logic into SQL queries.

## Syntax

```sql
CREATE OR REPLACE FUNCTION function_name (parameter_list)
RETURN TABLE_TYPE
AS
BEGIN
    -- Function logic
END;
/
```

### Components:
- **`function_name`**: The name of the function.
- **`parameter_list`**: Parameters required by the function.
- **`TABLE_TYPE`**: The type of table or collection that the function returns.

## Creating a Table Function

Hereâ€™s an example of how to create a table function:

### Example 1: Simple Table Function

```sql
-- Create a table type
CREATE OR REPLACE TYPE employee_type AS OBJECT (
    emp_id NUMBER,
    emp_name VARCHAR2(50),
    emp_salary NUMBER
);
/

-- Create a table type that holds a collection of employee_type
CREATE OR REPLACE TYPE employee_table_type AS TABLE OF employee_type;
/

-- Create the table function
CREATE OR REPLACE FUNCTION get_employees_by_dept(dept_id NUMBER)
RETURN employee_table_type
AS
    employee_list employee_table_type := employee_table_type();
BEGIN
    -- Add logic to populate the employee_list
    FOR rec IN (SELECT emp_id, emp_name, emp_salary
                FROM employees
                WHERE department_id = dept_id) LOOP
        employee_list.EXTEND;
        employee_list(employee_list.COUNT) := employee_type(rec.emp_id, rec.emp_name, rec.emp_salary);
    END LOOP;

    RETURN employee_list;
END;
/
```

## Using the Table Function

Once the table function is created, it can be queried just like a regular table in SQL.

```sql
SELECT * FROM TABLE(get_employees_by_dept(10));
```

## Use Cases

1. **Complex Queries**: Table functions are ideal for complex queries that require procedural logic.
2. **Data Transformation**: They are useful for transforming and processing data before returning it.
3. **Dynamic Queries**: When the query logic changes based on input parameters, table functions can adapt and return results dynamically.

## Advantages

1. **Encapsulation of Logic**: Complex query logic can be encapsulated within a function, making the SQL queries simpler.
2. **Reusability**: Functions can be reused in multiple queries, reducing redundancy and promoting code reuse.
3. **Flexibility**: Table functions offer flexibility in terms of processing data and integrating with SQL operations.
4. **Improved Performance**: By encapsulating complex operations in a table function, you can optimize performance and reduce the load on application code.

## Best Practices

1. **Error Handling**: Include robust error handling within your table functions to manage exceptions gracefully.
2. **Testing**: Thoroughly test table functions with different input parameters to ensure correctness and performance.
3. **Documentation**: Document the purpose, parameters, and behavior of your table functions for easier maintenance and understanding.



