### **Project: E-Commerce Inventory Management System**

#### **1. Schema Setup**

**1.1. Tables**

```sql

-- Products Table
CREATE TABLE Products (
    ProductID NUMBER PRIMARY KEY,
    ProductName VARCHAR2(100) NOT NULL,
    Price NUMBER NOT NULL,
    StockQuantity NUMBER
);

-- Orders Table
CREATE TABLE Orders (
    OrderID NUMBER PRIMARY KEY,
    OrderDate DATE DEFAULT SYSDATE,
    CustomerName VARCHAR2(100),
    TotalAmount NUMBER
);

-- OrderItems Table
CREATE TABLE OrderItems (
    OrderItemID NUMBER PRIMARY KEY,
    OrderID NUMBER,
    ProductID NUMBER,
    Quantity NUMBER,
    FOREIGN KEY (OrderID) REFERENCES Orders(OrderID),
    FOREIGN KEY (ProductID) REFERENCES Products(ProductID)
);

-- StockMovements Table
CREATE TABLE StockMovements (
    MovementID NUMBER PRIMARY KEY,
    ProductID NUMBER,
    MovementDate DATE DEFAULT SYSDATE,
    Quantity NUMBER,
    MovementType VARCHAR2(50), -- 'IN' or 'OUT'
    FOREIGN KEY (ProductID) REFERENCES Products(ProductID)
);


-- Additional Table: Categories
CREATE TABLE Categories (
    CategoryID NUMBER PRIMARY KEY,
    CategoryName VARCHAR2(100)
);

-- Additional Table: ProductCategories
CREATE TABLE ProductCategories (
    ProductID NUMBER,
    CategoryID NUMBER,
    FOREIGN KEY (ProductID) REFERENCES Products(ProductID),
    FOREIGN KEY (CategoryID) REFERENCES Categories(CategoryID)
);
```

**1.2. Sample Data**

```sql

-- Insert sample products
INSERT INTO Products (ProductID, ProductName, Price, StockQuantity) VALUES (1, 'Laptop', 1000, 50);
INSERT INTO Products (ProductID, ProductName, Price, StockQuantity) VALUES (2, 'Phone', 600, 100);
INSERT INTO Products (ProductID, ProductName, Price, StockQuantity) VALUES (3, 'Tablet', 300, 75);

-- Insert sample orders
INSERT INTO Orders (OrderID, CustomerName, TotalAmount) VALUES (1001, 'John Doe', 1600);
INSERT INTO Orders (OrderID, CustomerName, TotalAmount) VALUES (1002, 'Jane Smith', 900);

-- Insert sample order items
INSERT INTO OrderItems (OrderItemID, OrderID, ProductID, Quantity) VALUES (1, 1001, 1, 1);
INSERT INTO OrderItems (OrderItemID, OrderID, ProductID, Quantity) VALUES (2, 1001, 2, 1);
INSERT INTO OrderItems (OrderItemID, OrderID, ProductID, Quantity) VALUES (3, 1002, 2, 1);
INSERT INTO OrderItems (OrderItemID, OrderID, ProductID, Quantity) VALUES (4, 1002, 3, 2);


-- Insert sample categories
INSERT INTO Categories (CategoryID, CategoryName) VALUES (1, 'Electronics');
INSERT INTO Categories (CategoryID, CategoryName) VALUES (2, 'Mobile Phones');
INSERT INTO Categories (CategoryID, CategoryName) VALUES (3, 'Computers');

-- Insert product categories
INSERT INTO ProductCategories (ProductID, CategoryID) VALUES (1, 3);
INSERT INTO ProductCategories (ProductID, CategoryID) VALUES (2, 2);
INSERT INTO ProductCategories (ProductID, CategoryID) VALUES (3, 1);

-- Additional sample data for orders
INSERT INTO Orders (OrderID, CustomerName, TotalAmount) VALUES (1003, 'Alice Johnson', 1200);
INSERT INTO Orders (OrderID, CustomerName, TotalAmount) VALUES (1004, 'Bob Brown', 700);

-- Additional sample data for order items
INSERT INTO OrderItems (OrderItemID, OrderID, ProductID, Quantity) VALUES (5, 1003, 1, 1);
INSERT INTO OrderItems (OrderItemID, OrderID, ProductID, Quantity) VALUES (6, 1003, 3, 2);
INSERT INTO OrderItems (OrderItemID, OrderID, ProductID, Quantity) VALUES (7, 1004, 2, 1);
INSERT INTO OrderItems (OrderItemID, OrderID, ProductID, Quantity) VALUES (8, 1004, 3, 1);
```

#### **2. PL/SQL Components**

**2.1. Procedures**

```sql
-- Procedure to delete an order
CREATE OR REPLACE PROCEDURE DeleteOrder (p_order_id IN NUMBER) AS
BEGIN
    -- Delete order items first
    DELETE FROM OrderItems WHERE OrderID = p_order_id;
    
    -- Delete the order
    DELETE FROM Orders WHERE OrderID = p_order_id;
    
    DBMS_OUTPUT.PUT_LINE('Order ' || p_order_id || ' deleted successfully.');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error deleting order: ' || SQLERRM);
END DeleteOrder;

-- Procedure to update product price
CREATE OR REPLACE PROCEDURE UpdateProductPrice (
    p_product_id IN NUMBER,
    p_new_price IN NUMBER
) AS
BEGIN
    UPDATE Products
    SET Price = p_new_price
    WHERE ProductID = p_product_id;
    
    DBMS_OUTPUT.PUT_LINE('Updated Product ID ' || p_product_id || ' to new price: ' || p_new_price);
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Product ID ' || p_product_id || ' not found.');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error updating product price: ' || SQLERRM);
END UpdateProductPrice;

-- Procedure to restock a product
CREATE OR REPLACE PROCEDURE RestockProduct (
    p_product_id IN NUMBER,
    p_quantity IN NUMBER
) AS
BEGIN
    -- Add quantity to stock
    UPDATE Products
    SET StockQuantity = StockQuantity + p_quantity
    WHERE ProductID = p_product_id;
    
    -- Log the stock movement
    INSERT INTO StockMovements (ProductID, Quantity, MovementType) VALUES (p_product_id, p_quantity, 'IN');
    
    DBMS_OUTPUT.PUT_LINE('Restocked Product ID ' || p_product_id || ' with quantity: ' || p_quantity);
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error restocking product: ' || SQLERRM);
END RestockProduct;

-- Procedure to create a category
CREATE OR REPLACE PROCEDURE CreateCategory (
    p_category_name IN VARCHAR2
) AS
    v_category_id NUMBER;
BEGIN
    INSERT INTO Categories (CategoryName) VALUES (p_category_name)
    RETURNING CategoryID INTO v_category_id;
    
    DBMS_OUTPUT.PUT_LINE('Category created with ID: ' || v_category_id);
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error creating category: ' || SQLERRM);
END CreateCategory;

-- Procedure to associate product with category
CREATE OR REPLACE PROCEDURE AssociateProductCategory (
    p_product_id IN NUMBER,
    p_category_id IN NUMBER
) AS
BEGIN
    INSERT INTO ProductCategories (ProductID, CategoryID) VALUES (p_product_id, p_category_id);
    DBMS_OUTPUT.PUT_LINE('Product ID ' || p_product_id || ' associated with Category ID ' || p_category_id);
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error associating product with category: ' || SQLERRM);
END AssociateProductCategory;

-- Procedure to remove product from category
CREATE OR REPLACE PROCEDURE RemoveProductFromCategory (
    p_product_id IN NUMBER,
    p_category_id IN NUMBER
) AS
BEGIN
    DELETE FROM ProductCategories WHERE ProductID = p_product_id AND CategoryID = p_category_id;
    DBMS_OUTPUT.PUT_LINE('Product ID ' || p_product_id || ' removed from Category ID ' || p_category_id);
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error removing product from category: ' || SQLERRM);
END RemoveProductFromCategory;

-- Procedure to fetch top N products by stock quantity
CREATE OR REPLACE PROCEDURE FetchTopNProducts (
    p_limit IN NUMBER,
    p_cursor OUT SYS_REFCURSOR
) AS
BEGIN
    OPEN p_cursor FOR
        SELECT ProductID, ProductName, StockQuantity
        FROM Products
        ORDER BY StockQuantity DESC
        FETCH FIRST p_limit ROWS ONLY;
END FetchTopNProducts;

-- Procedure to fetch orders for a specific customer
CREATE OR REPLACE PROCEDURE FetchCustomerOrders (
    p_customer_name IN VARCHAR2,
    p_cursor OUT SYS_REFCURSOR
) AS
BEGIN
    OPEN p_cursor FOR
        SELECT * FROM Orders
        WHERE CustomerName = p_customer_name;
END FetchCustomerOrders;

-- Procedure to update order total
CREATE OR REPLACE PROCEDURE UpdateOrderTotal (
    p_order_id IN NUMBER
) AS
    v_total_amount NUMBER := 0;
BEGIN
    -- Calculate total amount for the order
    SELECT SUM(oi.Quantity * p.Price)
    INTO v_total_amount
    FROM OrderItems oi
    JOIN Products p ON oi.ProductID = p.ProductID
    WHERE oi.OrderID = p_order_id;
    
    -- Update order total amount
    UPDATE Orders
    SET TotalAmount = v_total_amount
    WHERE OrderID = p_order_id;
    
    DBMS_OUTPUT.PUT_LINE('Updated total amount for Order ID ' || p_order_id || ': ' || v_total_amount);
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error updating order total: ' || SQLERRM);
END UpdateOrderTotal;

-- Procedure to delete stock movements for a product
CREATE OR REPLACE PROCEDURE DeleteStockMovements (
    p_product_id IN NUMBER
) AS
BEGIN
    DELETE FROM StockMovements WHERE ProductID = p_product_id;
    DBMS_OUTPUT.PUT_LINE('Deleted stock movements for Product ID ' || p_product_id);
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error deleting stock movements: ' || SQLERRM);
END DeleteStockMovements;
```

**2.2. Functions**

```sql
-- Function to get product details by name
CREATE OR REPLACE FUNCTION GetProductDetails (
    p_product_name IN VARCHAR2
) RETURN SYS_REFCURSOR AS
    v_cursor SYS_REFCURSOR;
BEGIN
    OPEN v_cursor FOR
        SELECT * FROM Products
        WHERE ProductName = p_product_name;
    RETURN v_cursor;
END GetProductDetails;

-- Function to calculate discount on a product
CREATE OR REPLACE FUNCTION CalculateDiscount (
    p_product_id IN NUMBER,
    p_discount_percent IN NUMBER
) RETURN NUMBER AS
    v_price NUMBER;
    v_discounted_price NUMBER;
BEGIN
    SELECT Price INTO v_price FROM Products WHERE ProductID = p_product_id;
    v_discounted_price := v_price - (v_price * p_discount_percent / 100);
    RETURN v_discounted_price;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 0;
END CalculateDiscount;

-- Function to get total number of orders for a product
CREATE OR REPLACE FUNCTION GetTotalOrdersForProduct (
    p_product_id IN NUMBER
) RETURN NUMBER AS
    v_order_count NUMBER;
BEGIN
    SELECT COUNT(*) INTO v_order_count
    FROM OrderItems
    WHERE ProductID = p_product_id;
    RETURN v_order_count;
EXCEPTION
    WHEN OTHERS THEN
        RETURN 0;
END GetTotalOrdersForProduct;

-- Function to check stock availability
CREATE OR REPLACE FUNCTION CheckStockAvailability (
    p_product_id IN NUMBER,
    p_required_quantity IN NUMBER
) RETURN BOOLEAN AS
    v_stock_quantity NUMBER;
BEGIN
    SELECT StockQuantity INTO v_stock_quantity FROM Products WHERE ProductID = p_product_id;
    RETURN v_stock_quantity >= p_required_quantity;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN FALSE;
END CheckStockAvailability;

-- Function

 to calculate order total
CREATE OR REPLACE FUNCTION CalculateOrderTotal (
    p_order_id IN NUMBER
) RETURN NUMBER AS
    v_total_amount NUMBER;
BEGIN
    SELECT SUM(oi.Quantity * p.Price)
    INTO v_total_amount
    FROM OrderItems oi
    JOIN Products p ON oi.ProductID = p.ProductID
    WHERE oi.OrderID = p_order_id;
    RETURN v_total_amount;
EXCEPTION
    WHEN OTHERS THEN
        RETURN 0;
END CalculateOrderTotal;

-- Function to get most expensive product
CREATE OR REPLACE FUNCTION GetMostExpensiveProduct RETURN Products%ROWTYPE AS
    v_product Products%ROWTYPE;
BEGIN
    SELECT * INTO v_product
    FROM Products
    ORDER BY Price DESC
    FETCH FIRST ROW ONLY;
    RETURN v_product;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN NULL;
END GetMostExpensiveProduct;

-- Function to get average stock quantity
CREATE OR REPLACE FUNCTION GetAverageStockQuantity RETURN NUMBER AS
    v_avg_stock NUMBER;
BEGIN
    SELECT AVG(StockQuantity) INTO v_avg_stock FROM Products;
    RETURN v_avg_stock;
EXCEPTION
    WHEN OTHERS THEN
        RETURN 0;
END GetAverageStockQuantity;

-- Function to get order status
CREATE OR REPLACE FUNCTION GetOrderStatus (
    p_order_id IN NUMBER
) RETURN VARCHAR2 AS
    v_status VARCHAR2(50);
BEGIN
    SELECT Status INTO v_status FROM Orders WHERE OrderID = p_order_id;
    RETURN v_status;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 'Unknown';
END GetOrderStatus;

-- Function to get product category
CREATE OR REPLACE FUNCTION GetProductCategory (
    p_product_id IN NUMBER
) RETURN VARCHAR2 AS
    v_category_name VARCHAR2(100);
BEGIN
    SELECT c.CategoryName
    INTO v_category_name
    FROM ProductCategories pc
    JOIN Categories c ON pc.CategoryID = c.CategoryID
    WHERE pc.ProductID = p_product_id;
    RETURN v_category_name;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 'No Category';
END GetProductCategory;

-- Function to get discount percentage for a product
CREATE OR REPLACE FUNCTION GetDiscountPercentage (
    p_product_id IN NUMBER
) RETURN NUMBER AS
    v_discount_percentage NUMBER;
BEGIN
    SELECT DiscountPercentage INTO v_discount_percentage FROM Products WHERE ProductID = p_product_id;
    RETURN v_discount_percentage;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 0;
END GetDiscountPercentage;
```

**2.3. Packages**

```sql
-- Package Specification
CREATE OR REPLACE PACKAGE ProductPackage AS
    PROCEDURE AddProduct (p_name IN VARCHAR2, p_price IN NUMBER, p_stock IN NUMBER);
    FUNCTION GetProductPrice (p_product_id IN NUMBER) RETURN NUMBER;
    PROCEDURE UpdateStock (p_product_id IN NUMBER, p_quantity IN NUMBER);
    FUNCTION GetProductStock (p_product_id IN NUMBER) RETURN NUMBER;
END ProductPackage;

-- Package Body
CREATE OR REPLACE PACKAGE BODY ProductPackage AS

    PROCEDURE AddProduct (
        p_name IN VARCHAR2,
        p_price IN NUMBER,
        p_stock IN NUMBER
    ) AS
    BEGIN
        INSERT INTO Products (ProductName, Price, StockQuantity) VALUES (p_name, p_price, p_stock);
        DBMS_OUTPUT.PUT_LINE('Product ' || p_name || ' added successfully.');
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('Error adding product: ' || SQLERRM);
    END AddProduct;

    FUNCTION GetProductPrice (
        p_product_id IN NUMBER
    ) RETURN NUMBER AS
        v_price NUMBER;
    BEGIN
        SELECT Price INTO v_price FROM Products WHERE ProductID = p_product_id;
        RETURN v_price;
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            RETURN 0;
    END GetProductPrice;

    PROCEDURE UpdateStock (
        p_product_id IN NUMBER,
        p_quantity IN NUMBER
    ) AS
    BEGIN
        UPDATE Products SET StockQuantity = StockQuantity + p_quantity WHERE ProductID = p_product_id;
        DBMS_OUTPUT.PUT_LINE('Updated stock for Product ID ' || p_product_id || ' by quantity: ' || p_quantity);
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('Error updating stock: ' || SQLERRM);
    END UpdateStock;

    FUNCTION GetProductStock (
        p_product_id IN NUMBER
    ) RETURN NUMBER AS
        v_stock NUMBER;
    BEGIN
        SELECT StockQuantity INTO v_stock FROM Products WHERE ProductID = p_product_id;
        RETURN v_stock;
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            RETURN 0;
    END GetProductStock;

END ProductPackage;
```

**2.4. Triggers**

```sql
-- Trigger to update stock movements on product update
CREATE OR REPLACE TRIGGER trg_update_stock_movements
AFTER UPDATE OF StockQuantity ON Products
FOR EACH ROW
BEGIN
    IF :OLD.StockQuantity < :NEW.StockQuantity THEN
        INSERT INTO StockMovements (ProductID, Quantity, MovementType) 
        VALUES (:NEW.ProductID, :NEW.StockQuantity - :OLD.StockQuantity, 'IN');
    ELSE
        INSERT INTO StockMovements (ProductID, Quantity, MovementType) 
        VALUES (:NEW.ProductID, :OLD.StockQuantity - :NEW.StockQuantity, 'OUT');
    END IF;
END;

-- Trigger to auto-calculate order total on order item insertion
CREATE OR REPLACE TRIGGER trg_auto_calculate_order_total
AFTER INSERT ON OrderItems
FOR EACH ROW
BEGIN
    UPDATE Orders
    SET TotalAmount = (
        SELECT SUM(oi.Quantity * p.Price)
        FROM OrderItems oi
        JOIN Products p ON oi.ProductID = p.ProductID
        WHERE oi.OrderID = :NEW.OrderID
    )
    WHERE OrderID = :NEW.OrderID;
END;

-- Trigger to prevent negative stock quantities
CREATE OR REPLACE TRIGGER trg_prevent_negative_stock
BEFORE UPDATE OF StockQuantity ON Products
FOR EACH ROW
BEGIN
    IF :NEW.StockQuantity < 0 THEN
        RAISE_APPLICATION_ERROR(-20001, 'Stock quantity cannot be negative.');
    END IF;
END;

-- Trigger to log deletion of orders
CREATE OR REPLACE TRIGGER trg_log_order_deletion
AFTER DELETE ON Orders
FOR EACH ROW
BEGIN
    INSERT INTO OrderDeletionLog (OrderID, DeletionDate)
    VALUES (:OLD.OrderID, SYSDATE);
END;

-- Trigger to set default values for new products
CREATE OR REPLACE TRIGGER trg_set_default_product_values
BEFORE INSERT ON Products
FOR EACH ROW
BEGIN
    IF :NEW.Price IS NULL THEN
        :NEW.Price := 0;
    END IF;
    IF :NEW.StockQuantity IS NULL THEN
        :NEW.StockQuantity := 0;
    END IF;
END;
```

**2.5. Exception Handling**

```sql
-- Procedure with exception handling
CREATE OR REPLACE PROCEDURE ProcessOrder (
    p_order_id IN NUMBER
) AS
BEGIN
    -- Fetch order details
    SELECT * INTO v_order
    FROM Orders
    WHERE OrderID = p_order_id;
    
    -- Process order (dummy operation)
    DBMS_OUTPUT.PUT_LINE('Processing Order ID: ' || p_order_id);
    
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Order ID ' || p_order_id || ' not found.');
    WHEN VALUE_ERROR THEN
        DBMS_OUTPUT.PUT_LINE('Value error processing Order ID ' || p_order_id);
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Unexpected error: ' || SQLERRM);
END ProcessOrder;

-- Function with exception handling
CREATE OR REPLACE FUNCTION SafeDivide (
    p_numerator IN NUMBER,
    p_denominator IN NUMBER
) RETURN NUMBER AS
BEGIN
    RETURN p_numerator / p_denominator;
EXCEPTION
    WHEN ZERO_DIVIDE THEN
        RETURN NULL; -- Handle divide-by-zero error
    WHEN OTHERS THEN
        RETURN NULL; -- Handle other unexpected errors
END SafeDivide;
```

**2.6. Collections**

```sql
-- Collection types
CREATE OR REPLACE TYPE ProductTableType AS TABLE OF Products%ROWTYPE;

-- Procedure using collections
CREATE OR REPLACE PROCEDURE ProcessProducts (
    p_product_table IN ProductTableType
) AS
BEGIN
    FOR i IN 1..p_product_table.COUNT LOOP
        DBMS_OUTPUT.PUT_LINE('Processing Product ID: ' || p_product_table(i).ProductID || ', Name: ' || p_product_table(i).ProductName);
    END LOOP;
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error processing products: ' || SQLERRM);
END ProcessProducts;
```

**2.7. REF CURSORS**

```sql
-- Procedure with REF CURSOR
CREATE OR REPLACE PROCEDURE GetProductDetailsByCategory (
    p_category_name IN VARCHAR2,
    p_cursor OUT SYS_REFCURSOR
) AS
BEGIN
    OPEN p_cursor FOR
        SELECT p.ProductID, p.ProductName, p.Price
        FROM Products p
        JOIN ProductCategories pc ON p.ProductID = pc.ProductID
        JOIN Categories c ON pc.CategoryID = c.CategoryID
        WHERE c.CategoryName = p_category_name;
END GetProductDetailsByCategory;

-- Procedure to fetch product details using REF CURSOR
CREATE OR REPLACE PROCEDURE DisplayProducts (
    p_cursor IN SYS_REFCURSOR
) AS
    v_product Products%ROWTYPE;
BEGIN
    LOOP
        FETCH p_cursor INTO v_product;
        EXIT WHEN p_cursor%NOTFOUND;
        DBMS_OUTPUT.PUT

_LINE('Product ID: ' || v_product.ProductID || ', Name: ' || v_product.ProductName || ', Price: ' || v_product.Price);
    END LOOP;
    CLOSE p_cursor;
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error displaying products: ' || SQLERRM);
END DisplayProducts;
```

**2.8. Bulk Collect**

```sql
-- Procedure using BULK COLLECT
CREATE OR REPLACE PROCEDURE BulkCollectProducts (
    p_category_name IN VARCHAR2
) AS
    TYPE ProductTable IS TABLE OF Products%ROWTYPE;
    v_products ProductTable;
BEGIN
    SELECT * BULK COLLECT INTO v_products
    FROM Products p
    JOIN ProductCategories pc ON p.ProductID = pc.ProductID
    JOIN Categories c ON pc.CategoryID = c.CategoryID
    WHERE c.CategoryName = p_category_name;
    
    FOR i IN 1..v_products.COUNT LOOP
        DBMS_OUTPUT.PUT_LINE('Product ID: ' || v_products(i).ProductID || ', Name: ' || v_products(i).ProductName);
    END LOOP;
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error fetching products: ' || SQLERRM);
END BulkCollectProducts;
```

**2.9. Pipeline Functions**

```sql
-- Function to fetch products by category using pipelining
CREATE OR REPLACE FUNCTION PipelineProductsByCategory (
    p_category_name IN VARCHAR2
) RETURN SYS_REFCURSOR PIPELINED AS
BEGIN
    OPEN PIPELINE FOR
        SELECT p.ProductID, p.ProductName, p.Price
        FROM Products p
        JOIN ProductCategories pc ON p.ProductID = pc.ProductID
        JOIN Categories c ON pc.CategoryID = c.CategoryID
        WHERE c.CategoryName = p_category_name;
    RETURN;
END PipelineProductsByCategory;
```

**2.10. Dynamic SQL**

```sql
-- Procedure using Dynamic SQL to fetch products by dynamic condition
CREATE OR REPLACE PROCEDURE FetchProductsByCondition (
    p_condition IN VARCHAR2
) AS
    v_sql VARCHAR2(4000);
    v_cursor SYS_REFCURSOR;
BEGIN
    v_sql := 'SELECT ProductID, ProductName, Price FROM Products WHERE ' || p_condition;
    OPEN v_cursor FOR v_sql;
    
    -- Display products
    LOOP
        FETCH v_cursor INTO v_product;
        EXIT WHEN v_cursor%NOTFOUND;
        DBMS_OUTPUT.PUT_LINE('Product ID: ' || v_product.ProductID || ', Name: ' || v_product.ProductName || ', Price: ' || v_product.Price);
    END LOOP;
    
    CLOSE v_cursor;
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error executing dynamic SQL: ' || SQLERRM);
END FetchProductsByCondition;
```
